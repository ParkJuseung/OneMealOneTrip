<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/main}">

<th:block layout:fragment="style">
	<link rel="stylesheet" th:href="@{/css/chat.css}">
</th:block>

<body>
<th:block layout:fragment="content">
	<!-- ì±„íŒ…ë°© ëª©ë¡ ì˜ì—­ -->
	<div class="chat-list-container">


		<!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
		<div class="tab-navigation">
			<div class="tab" data-tab="all" onclick="location.href='/post'">í¬ìŠ¤íŠ¸</div>
			<div class="tab" data-tab="companion" onclick="location.href='/travel'">ì¶”ì²œ ì—¬í–‰ê²½ë¡œ</div>
			<div class="tab active" data-tab="chat" onclick="location.href='/chat'">ì±„íŒ…</div>
<!--			<div class="tab" data-tab="explorer" style="display: none"></div>-->
			<div class="tab-indicator"></div>
		</div>


		<!-- ê²€ìƒ‰ ë° í•„í„° ì˜ì—­ -->
		<div class="chat-controls">
			<h3 class="chat-list-title">ì±„íŒ…ë°© ëª©ë¡</h3>
			<div class="create-chat" id="create-chat-btn">
				<i class="fas fa-plus"></i> ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°
			</div>
		</div>

		<div class="search-box">
			<i class="fas fa-search search-icon"></i>
			<input type="text" class="search-input" placeholder="ì±„íŒ…ë°© ê²€ìƒ‰..." id="chat-search-input">

			<ul id="suggestion-list" class="suggestion-list"></ul>
		</div>

		<div class="chat-filters">
			<div class="chat-filter active" data-filter="all">ì „ì²´</div>
			<div class="chat-filter" data-filter="popular">ì¸ê¸°</div>
			<div class="chat-filter" data-filter="mine">ë‚˜ì˜ ì±„íŒ…ë°©</div>
		</div>

		<!-- ì±„íŒ…ë°© ëª©ë¡ ì˜ì—­ -->
		<div class="chat-list">
			<div class="chat-room"
				 th:each="room : ${chatRooms}"
				 th:classappend="${room.myRole == 'OWNER'} ? ' owner-room' : ''"
				 th:attr="data-id=${room.id}, data-room-id=${room.id}">
				<!-- ì™¼ìª½: ì¸ë„¤ì¼ + ì°¸ì—¬ì ìˆ˜ -->
				<div class="chat-left">
					<img th:src="${room.thumbnailImageUrl != null ? room.thumbnailImageUrl : '/images/chat/default-thumbnail-100x100.png'}"
						 alt="ì±„íŒ…ë°© ì´ë¯¸ì§€" class="chat-avatar" />
					<div class="chat-participant-count">
						ì°¸ì—¬ì: <span th:text="${room.participantCount}">0</span>ëª…
					</div>
				</div>

				<!-- ì¤‘ì•™ ë‚´ìš© -->
				<div class="chat-center">
					<div class="chat-title" th:text="${room.title}">ì±„íŒ…ë°© ì œëª©</div>

					<div class="chat-hashtags">
						<div class="chat-hashtag" th:each="tag : ${room.hashtags}" th:text="'#' + ${tag}">#í•´ì‹œíƒœê·¸
						</div>
					</div>

					<div class="chat-owner">
						ë°©ì¥: <span th:text="${room.ownerNickname}"></span>
					</div>
				</div>

				<!-- ì˜¤ë¥¸ìª½: ì‹œê°„ + ì¢‹ì•„ìš” -->
				<div class="chat-right">
					<div class="chat-time" th:text="${#temporals.format(room.createdAt, 'yy-MM-dd HH:mm')}">ì‹œê°„</div>
					<div class="chat-likes" data-room-id="${room.id}">
						<i class="${room.liked ? 'fas' : 'far'} fa-heart like-icon"></i>
						<span class="like-count">${room.likeCount}</span>
					</div>
				</div>
			</div>
		</div>

		<!-- ë”ë³´ê¸° ë²„íŠ¼ -->
		<div class="load-more-container">
			<button id="load-more-btn" class="load-more-btn">
				ë”ë³´ê¸°
			</button>
			<div id="loading-spinner" class="loading-spinner" style="display: none;">
				<img src="/images/loadingspinner/spinner.svg" alt="ë¡œë”© ì¤‘" />
			</div>
			<div id="end-message" class="end-message" style="display: none;">
				ë§ˆì§€ë§‰ ì±„íŒ…ë°©ì…ë‹ˆë‹¤.
			</div>
		</div>


		<!-- ì±„íŒ…ë°© ìƒì„¸ ëª¨ë‹¬ -->
		<div class="modal-overlay" id="chat-detail-modal">
			<div class="modal">
				<div class="modal-inner">
					<div class="modal-header">
						<h3 class="modal-title">ì±„íŒ…ë°© ìƒì„¸ ì •ë³´</h3>
						<div class="modal-close" id="close-detail-modal">
							<i class="fas fa-times"></i>
						</div>
					</div>
					<div class="modal-scroll-container">
						<div class="modal-body chatroom-detail-modal">

							<!-- ìƒë‹¨ ë°°ê²½ ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì˜ì—­ -->
							<div class="chatroom-header" id="detail-thumbnail-area">
								<!-- ìƒì„¸ ëª¨ë‹¬ì˜ ì¢‹ì•„ìš” í‘œì‹œ ì˜ì—­ -->
								<div class="like-toggle" id="like-toggle">
									<i class="far fa-heart"></i> <!-- filled: fas, empty: far -->
								</div>
								<div class="chatroom-header-content">
									<div class="chatroom-title" id="detail-title">ì±„íŒ…ë°© ì œëª©</div>
									<div class="chatroom-meta">
										ì°¸ì—¬ì <span id="detail-participants">0</span>ëª… Â· ê°œì„¤ì¼ <span id="detail-created-at">YYYY.MM.DD</span>
									</div>
								</div>
							</div>

							<!-- ë°©ì¥ -->
							<div class="chatroom-owner" id="detail-owner">ë°©ì¥: -</div>

							<!-- í•´ì‹œíƒœê·¸ -->
							<div class="chatroom-tags" id="detail-hashtags">
								<!-- ë™ì ìœ¼ë¡œ íƒœê·¸ê°€ ë“¤ì–´ê° -->
							</div>

							<!-- ê³µì§€ì‚¬í•­ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) -->
							<div class="chatroom-notice">
								<div class="section-title">ê³µì§€ì‚¬í•­</div>
								<div id="detail-notice" style="max-height: 120px; overflow-y: auto; white-space: pre-wrap; padding: 8px; border: 1px solid #ccc; border-radius: 8px; background: #fdfdfd;"></div>
							</div>

							<!-- ì„¤ëª…ê¸€ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) -->
							<div class="chatroom-description">
								<div class="section-title">ì„¤ëª…ê¸€</div>
								<div id="detail-description" style="max-height: 150px; overflow-y: auto; white-space: pre-wrap; padding: 8px; border: 1px solid #ccc; border-radius: 8px; background: #fdfdfd;"></div>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button class="create-button" id="enter-chatroom">ì±„íŒ…ë°© ì…ì¥í•˜ê¸°</button>
						<button class="cancel-button" id="leave-chatroom" style="display:none;">ì±„íŒ…ë°© ë‚˜ê°€ê¸°</button>
						<button class="create-button" id="edit-chatroom" style="display:none;">ì±„íŒ…ë°© ìˆ˜ì •</button>
						<button class="cancel-button" id="delete-chatroom"
								style="display:none; background-color: #f44336; color: white;">ì±„íŒ…ë°© ì‚­ì œ
						</button>
					</div>
				</div>
			</div>
		</div>


		<!-- ì±„íŒ…ë°© ìƒì„± ëª¨ë‹¬ -->
		<div class="modal-overlay" id="create-chat-modal">
			<div class="modal">
				<div class="modal-inner">
					<div class="modal-header">
						<h3 class="modal-title">ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°</h3>
						<div class="modal-close" id="close-create-modal">
							<i class="fas fa-times"></i>
						</div>
					</div>
					<div class="modal-scroll-container">
						<div class="form-group">
							<label class="form-label">ì±„íŒ…ë°© ì œëª©</label>
							<input type="text" class="form-input" id="chat-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 30ì)"
								   maxlength="30">
						</div>

						<div class="form-group">
							<label class="form-label">ì¸ë„¤ì¼ ì´ë¯¸ì§€ (ì„ íƒ)</label>
							<input type="file" class="form-input" id="chat-thumbnail" accept="image/png, image/jpeg">

							<!-- ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ -->
							<div class="thumbnail-preview-box-create">
								<img id="chatCreatePreview" src="/images/chat/default-thumbnail-100x100.png"
									 style="width: 100%; height: 100%; object-fit: contain; object-position: center;" />
							</div>
						</div>


						<div class="form-group">
							<label class="form-label">í•´ì‹œíƒœê·¸ (ìµœëŒ€ 5ê°œ)</label>
							<div class="hashtag-input">
								<input type="text" class="hashtag-input-field" placeholder="íƒœê·¸ ì…ë ¥ í›„ Enter...">
							</div>
						</div>
						<div class="form-group">
							<label class="form-label">ê³µì§€ì‚¬í•­ (ì„ íƒ)</label>
							<textarea class="form-textarea" id="chat-notice" placeholder="ì±„íŒ…ë°© ê³µì§€ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 100ì)"
									  maxlength="100"></textarea>
						</div>
						<div class="form-group">
							<label class="form-label">ì„¤ëª…ê¸€ (ì„ íƒ)</label>
							<textarea class="form-textarea" id="chat-description" placeholder="ì±„íŒ…ë°©ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 200ì)"
									  maxlength="200"></textarea>
						</div>
						<div class="modal-footer">
							<button class="cancel-button" id="cancel-create">ì·¨ì†Œ</button>
							<button class="create-button" id="confirm-create">ì±„íŒ…ë°© ë§Œë“¤ê¸°</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ì±„íŒ…ë°© ìˆ˜ì • ëª¨ë‹¬ -->
	<div class="modal-overlay" id="edit-chat-modal">
		<div class="modal">
			<div class="modal-inner">
				<div class="modal-header">
					<h3 class="modal-title">ì±„íŒ…ë°© ìˆ˜ì •</h3>
					<div class="modal-close" id="close-edit-modal">
						<i class="fas fa-times"></i>
					</div>
				</div>
				<div class="modal-scroll-container">
					<div class="form-group">
						<label class="form-label">ì±„íŒ…ë°© ì œëª©</label>
						<input type="text" class="form-input" id="edit-chat-title" maxlength="30" />
					</div>

					<div class="form-group">
						<label class="form-label">ì¸ë„¤ì¼ ì´ë¯¸ì§€ (ì„ íƒ)</label>
						<input type="file" class="form-input" id="edit-chat-thumbnail" accept="image/png, image/jpeg">
						<!-- ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸° -->
						<div class="thumbnail-preview-box">
							<img id="thumbnailPreview" src="/images/chat/default-thumbnail-100x100.png" alt="ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°"
								 style="width: 100%; object-fit: cover; border-radius: 6px; margin-top: 10px;" />
						</div>
						<!-- ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ì´ˆê¸°í™” ë²„íŠ¼ -->
						<button type="button" id="resetThumbnailBtn" class="form-button" style="margin-top: 8px;">
							ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ì´ˆê¸°í™”
						</button>
						<!-- ì´ˆê¸°í™” ì—¬ë¶€ í”Œë˜ê·¸ -->
						<input type="hidden" id="resetThumbnailFlag" name="resetThumbnail" value="false" />
					</div>

					<div class="form-group">
						<label class="form-label">í•´ì‹œíƒœê·¸ (ìµœëŒ€ 5ê°œ)</label>
						<div class="hashtag-input" id="edit-hashtag-container">
							<!-- ê¸°ì¡´ íƒœê·¸ ì±„ì›Œì§ -->
							<input type="text" class="hashtag-input-field" placeholder="íƒœê·¸ ì…ë ¥ í›„ Enter..." />
						</div>
					</div>

					<div class="form-group">
						<label class="form-label">ê³µì§€ì‚¬í•­</label>
						<textarea class="form-textarea" id="edit-chat-notice" maxlength="100"></textarea>
					</div>

					<div class="form-group">
						<label class="form-label">ì„¤ëª…ê¸€</label>
						<textarea class="form-textarea" id="edit-chat-description" maxlength="200"></textarea>
					</div>

					<div class="modal-footer">
						<button class="cancel-button" id="cancel-edit">ì·¨ì†Œ</button>
						<button class="create-button" id="confirm-edit">ì €ì¥</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// íƒ­ ë„¤ë¹„ê²Œì´ì…˜
		document.addEventListener('DOMContentLoaded', function () {
			const tabs = document.querySelectorAll('.tab');
			const indicator = document.querySelector('.tab-indicator');

			function setIndicatorPosition(activeTab) {
				const tabRect = activeTab.getBoundingClientRect();
				const navRect = document.querySelector('.tab-navigation').getBoundingClientRect();

				indicator.style.width = `${tabRect.width}px`;
				indicator.style.left = `${tabRect.left - navRect.left}px`;
			}

			tabs.forEach(tab => {
				tab.addEventListener('click', function () {
					tabs.forEach(t => t.classList.remove('active'));
					this.classList.add('active');
					setIndicatorPosition(this);
				});
			});

			// ì´ˆê¸° ì¸ë””ì¼€ì´í„° ìœ„ì¹˜ ì„¤ì •
			const activeTab = document.querySelector('.tab.active');
			if (activeTab) {
				setIndicatorPosition(activeTab);
			}

			// ì°½ í¬ê¸° ë³€ê²½ì‹œ ì¸ë””ì¼€ì´í„° ìœ„ì¹˜ ì¡°ì •
			window.addEventListener('resize', function () {
				const activeTab = document.querySelector('.tab.active');
				if (activeTab) {
					setIndicatorPosition(activeTab);
				}
			});

			// ğŸ”§ ì´ë¯¸ì§€ í´ë¦­ ì‹œ ìƒì„¸ë³´ê¸°ë¡œ ì´ë™
			document.querySelectorAll('.post-image').forEach(image => {
				image.addEventListener('click', function() {
					const postCard = this.closest('.post-card');
					const viewBtn = postCard.querySelector('.view-btn');
					if (viewBtn) {
						viewBtn.click();
					}
				});
			});
		});

		// ì‚¬ìš©ì ì„ íƒ íƒ­
		const userTabs = document.querySelectorAll('.user-tab');
		userTabs.forEach(tab => {
			tab.addEventListener('click', function () {
				userTabs.forEach(t => t.classList.remove('active'));
				this.classList.add('active');
			});
		});

		// í† í”½ ë°°ì§€
		const topicBadges = document.querySelectorAll('.topic-badge');
		topicBadges.forEach(badge => {
			badge.addEventListener('click', function () {
				this.classList.toggle('active');
			});
		});

		// ë·° ì˜µì…˜
		const viewOptions = document.querySelectorAll('.view-option');
		viewOptions.forEach(option => {
			option.addEventListener('click', function () {
				viewOptions.forEach(o => o.classList.remove('active'));
				this.classList.add('active');
			});
		});
	</script>


	<!-- ëª¨ë‹¬ ëª¨ë“ˆ -->
	<script type="module">
		import {
			bindModalCloseButtons,
			bindCreateModalOpen,
			bindHashtagInputs,
			initCreateModal,
			initEditModal,
			initDetailModal
		} from '/js/chat-modal-utils.js';

		document.addEventListener('DOMContentLoaded', () => {
			bindModalCloseButtons();
			bindCreateModalOpen();
			bindHashtagInputs();
			initCreateModal();
			initEditModal();

			// ì¸ë„¤ì¼ ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸° ë° ì´ˆê¸°í™” ë¡œì§
			const thumbnailInput = document.getElementById('edit-chat-thumbnail');
			const thumbnailPreview = document.getElementById('thumbnailPreview');
			const resetBtn = document.getElementById('resetThumbnailBtn');
			const resetFlag = document.getElementById('resetThumbnailFlag');

			const DEFAULT_IMAGE_URL = "/images/chat/default-thumbnail-100x100.png";

			if (thumbnailInput && thumbnailPreview && resetBtn && resetFlag) {
				thumbnailInput.addEventListener('change', function () {
					const file = this.files[0];
					if (file) {
						const reader = new FileReader();
						reader.onload = function (e) {
							thumbnailPreview.src = e.target.result;
						};
						reader.readAsDataURL(file);
						resetFlag.value = "false"; // ì‚¬ìš©ìê°€ íŒŒì¼ ì—…ë¡œë“œí–ˆìœ¼ë¯€ë¡œ reset ì·¨ì†Œ
					}
				});

				resetBtn.addEventListener('click', function () {
					thumbnailPreview.src = DEFAULT_IMAGE_URL;
					thumbnailInput.value = ""; // ì—…ë¡œë“œ íŒŒì¼ ì´ˆê¸°í™”
					resetFlag.value = "true";  // ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ì´ˆê¸°í™” ìš”ì²­
				});
			}




			initDetailModal();
		});
	</script>

	<script type="module">
		import {
			setDetailModal,
			controlDetailButtons,
			bindLikeToggle,
			openModal
		} from '/js/chat-modal-utils.js';

		let currentTab = 'ì „ì²´';
		let offset = 0;
		const limit = 10;

		const loadMoreBtn = document.getElementById('load-more-btn');
		const spinner = document.getElementById('loading-spinner');
		const endMessage = document.getElementById('end-message');

		document.addEventListener('DOMContentLoaded', () => {
			bindFilterTabEvents();
			bindSearchInput();
			bindLoadMore();
			loadChatRooms();
		});

		function bindFilterTabEvents() {
			document.querySelectorAll('.chat-filter').forEach(tab => {
				tab.addEventListener('click', () => {
					document.querySelectorAll('.chat-filter').forEach(el => el.classList.remove('active'));
					tab.classList.add('active');
					currentTab = tab.dataset.filter;
					offset = 0;
					loadChatRooms();
				});
			});
		}

		function bindSearchInput() {
			const input = document.getElementById('chat-search-input');
			const suggestionList = document.getElementById('suggestion-list');
			let debounceTimer;
			let selectedIndex = -1;

			input.addEventListener('keydown', e => {
				const items = suggestionList.querySelectorAll('li');
				if (e.key === 'ArrowDown') {
					e.preventDefault(); selectedIndex = (selectedIndex + 1) % items.length;
					updateActiveItem(items);
				} else if (e.key === 'ArrowUp') {
					e.preventDefault(); selectedIndex = (selectedIndex - 1 + items.length) % items.length;
					updateActiveItem(items);
				} else if (e.key === 'Enter') {
					if (selectedIndex >= 0 && selectedIndex < items.length) {
						e.preventDefault(); items[selectedIndex].click();
					}
				}
			});

			input.addEventListener('input', () => {
				const keyword = input.value.trim();
				offset = 0;

				clearTimeout(debounceTimer);
				debounceTimer = setTimeout(() => {
					loadChatRooms(keyword);

					if (keyword.length > 0) {
						fetch(`/api/suggestions?keyword=${encodeURIComponent(keyword)}`)
								.then(res => res.json())
								.then(suggestions => showSuggestions(suggestions));
					} else {
						suggestionList.innerHTML = '';
					}
				}, 300);
			});

			document.addEventListener('click', e => {
				if (!input.contains(e.target) && !suggestionList.contains(e.target)) {
					suggestionList.innerHTML = '';
				}
			});

			function updateActiveItem(items) {
				items.forEach((item, index) => {
					item.classList.toggle('active', index === selectedIndex);
					if (index === selectedIndex) item.scrollIntoView({ block: 'nearest' });
				});
			}

			function showSuggestions(suggestions) {
				suggestionList.innerHTML = '';
				selectedIndex = -1;
				suggestions.forEach(item => {
					const li = document.createElement('li');
					li.textContent = item;
					if (item.startsWith('#')) li.classList.add('hashtag-suggestion');
					if (item.startsWith('@')) li.classList.add('owner-suggestion');
					li.addEventListener('click', () => {
						input.value = item.replace(/^[@#]/, '');
						suggestionList.innerHTML = '';
						input.dispatchEvent(new Event('input'));
					});
					suggestionList.appendChild(li);
				});
			}
		}

		function bindLoadMore() {
			if (loadMoreBtn) {
				loadMoreBtn.addEventListener('click', async () => {
					offset += limit;
					loadMoreBtn.style.display = 'none';
					spinner.style.display = 'block';
					endMessage.style.display = 'none';

					const minDuration = new Promise(resolve => setTimeout(resolve, 800)); // ìµœì†Œ 800ms
					const dataPromise = loadChatRoomsData(offset, limit);

					const [data] = await Promise.all([
						dataPromise.then(data => [data]),
						minDuration
					]);

					renderChatRooms(data[0].rooms);

					if (data[0].rooms.length < limit) {
						endMessage.style.display = 'block';
						loadMoreBtn.style.display = 'none';
					} else {
						endMessage.style.display = 'none';
						loadMoreBtn.style.display = 'inline-block';
					}

					spinner.style.display = 'none';
				});
			}
		}

		async function loadChatRooms(keyword = '') {
			const { rooms } = await loadChatRoomsData(offset, limit, keyword);
			if (offset === 0) document.querySelector('.chat-list').innerHTML = '';
			renderChatRooms(rooms);
			if (rooms.length < limit) {
				endMessage.style.display = 'block';
				loadMoreBtn.style.display = 'none';
			} else {
				endMessage.style.display = 'none';
				loadMoreBtn.style.display = 'inline-block';
			}
		}

		async function loadChatRoomsData(offset, limit, keyword = '') {
			const path = currentTab === 'popular' ? '/popular' :
					currentTab === 'mine' ? '/mine' : '';
			const query = new URLSearchParams({ offset, limit });
			if (keyword) query.append('keyword', keyword);

			const res = await fetch(`/api/chatrooms${path}?${query.toString()}`);
			return await res.json();
		}

		function renderChatRooms(rooms) {
			const container = document.querySelector('.chat-list');
			rooms.forEach(room => {
				const div = document.createElement('div');
				div.className = `chat-room${room.myRole === 'OWNER' ? ' owner-room' : ''}`;
				div.setAttribute('data-id', room.id);
				div.setAttribute('data-room-id', room.id);
				div.innerHTML = `
		<div class="chat-left">
			<img src="${room.thumbnailImageUrl || '/images/chat/default-thumbnail-100x100.png'}" class="chat-avatar" />
			<div class="chat-participant-count">ì°¸ì—¬ì: ${room.participantCount}ëª…</div>
		</div>
		<div class="chat-center">
			<div class="chat-title">${room.title}</div>
			<div class="chat-hashtags">${room.hashtags.map(tag => `<div class="chat-hashtag">#${tag}</div>`).join('')}</div>
			<div class="chat-owner">ë°©ì¥: ${room.ownerNickname}</div>
		</div>
		<div class="chat-right">
			<div class="chat-time">${new Date(room.createdAt).toLocaleString('ko-KR')}</div>
			<div class="chat-likes" data-room-id="${room.id}">
			  <i class="${room.liked ? 'fas' : 'far'} fa-heart like-icon"></i>
			  <span class="like-count">${room.likeCount}</span>
			</div>
		</div>`;
				container.appendChild(div);

				// ìƒì„¸ ëª¨ë‹¬ ë°”ì¸ë”©
				div.addEventListener('click', async () => {
					try {
						const res = await fetch(`/api/chatrooms/${room.id}`);
						const roomDetail = await res.json();
						setDetailModal(roomDetail);
						controlDetailButtons(roomDetail.myRole);
						bindLikeToggle(room.id);
						openModal(document.getElementById('chat-detail-modal'));
					} catch (err) {
						alert('ì±„íŒ…ë°© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
						console.error(err);
					}
				});
			});
		}
	</script>

</th:block>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const tabs = document.querySelectorAll('.tab');
		const indicator = document.querySelector('.tab-indicator');
		const path = window.location.pathname;

		function getTabNameByPath(path) {
			if (path.startsWith('/post')) return 'all';
			if (path.startsWith('/travel')) return 'companion';
			if (path.startsWith('/chat')) return 'chat';
			return '';
		}

		const currentTabName = getTabNameByPath(path);

		// âœ… ê¸°ì¡´ active ì œê±°
		tabs.forEach(tab => tab.classList.remove('active'));

		tabs.forEach(tab => {
			const tabName = tab.getAttribute('data-tab');
			if (tabName === currentTabName) {
				tab.classList.add('active');
				setIndicatorPosition(tab);
			}
		});

		function setIndicatorPosition(activeTab) {
			const tabRect = activeTab.getBoundingClientRect();
			const navRect = document.querySelector('.tab-navigation').getBoundingClientRect();
			indicator.style.width = `${tabRect.width}px`;
			indicator.style.left = `${tabRect.left - navRect.left}px`;
		}

		window.addEventListener('resize', () => {
			const activeTab = document.querySelector('.tab.active');
			if (activeTab) {
				setIndicatorPosition(activeTab);
			}
		});
	});
</script>


</body>

</html>