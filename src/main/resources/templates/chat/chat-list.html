<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<th:block layout:fragment="style">
    <link rel="stylesheet" th:href="@{/css/chat.css}">
</th:block>
<body>
<th:block layout:fragment="content">
<!-- 채팅방 목록 영역 -->
<div class="chat-list-container">
    <!-- 검색 및 필터 영역 -->
    <div class="chat-controls">
        <h3 class="chat-list-title">채팅방 목록</h3>
        <div class="create-chat" id="create-chat-btn">
            <i class="fas fa-plus"></i> 새 채팅방 만들기
        </div>
    </div>

    <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" placeholder="채팅방 검색...">
    </div>

    <div class="chat-filters">
        <div class="chat-filter active">전체</div>
        <div class="chat-filter">🔥인기</div>
        <div class="chat-filter">나의 채팅방</div>
    </div>

    <!-- 채팅방 목록 -->
    <!--<div class="chat-list">
         채팅방 1 
        <div class="chat-room" data-id="1">
            <img src="/api/placeholder/60/60" alt="채팅방 이미지" class="chat-avatar">
            <div class="chat-info">
                <div class="chat-header">
                    <div class="chat-title">제주도 여행 동행자 모집</div>
                    <div class="chat-time">오후 3:45</div>
                </div>
                <div class="chat-preview">
                    <div class="chat-last-message">안녕하세요! 제주도 여행 계획 있으신가요?</div>
                </div>
                <div class="chat-hashtags">
                    <div class="chat-hashtag">#제주도</div>
                    <div class="chat-hashtag">#동행</div>
                </div>
                <div class="chat-participants">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <div class="chat-participant-count">+2</div>
                </div>
            </div>
        </div>

         채팅방 2 (읽지 않은 메시지가 있는 경우) 
        <div class="chat-room unread" data-id="2">
            <img src="/api/placeholder/60/60" alt="채팅방 이미지" class="chat-avatar">
            <div class="chat-info">
                <div class="chat-header">
                    <div class="chat-title">유럽 배낭여행 정보 공유방</div>
                    <div class="chat-time">오전 11:20</div>
                </div>
                <div class="chat-preview">
                    <div class="chat-last-message">프랑스 파리 숙소 추천해주실 분 계신가요?</div>
                    <div class="chat-badge">3</div>
                </div>
                <div class="chat-hashtags">
                    <div class="chat-hashtag">#유럽</div>
                    <div class="chat-hashtag">#배낭여행</div>
                    <div class="chat-hashtag">#정보공유</div>
                </div>
                <div class="chat-participants">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <div class="chat-participant-count">+8</div>
                </div>
            </div>
        </div>

         채팅방 3 
        <div class="chat-room" data-id="3">
            <img src="/api/placeholder/60/60" alt="채팅방 이미지" class="chat-avatar">
            <div class="chat-info">
                <div class="chat-header">
                    <div class="chat-title">동남아 맛집 탐방</div>
                    <div class="chat-time">어제</div>
                </div>
                <div class="chat-preview">
                    <div class="chat-last-message">베트남 하노이 반미 맛집 정보 공유합니다!</div>
                </div>
                <div class="chat-hashtags">
                    <div class="chat-hashtag">#동남아</div>
                    <div class="chat-hashtag">#맛집</div>
                </div>
                <div class="chat-participants">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <div class="chat-participant-count">+5</div>
                </div>
            </div>
        </div>

         채팅방 4 
        <div class="chat-room" data-id="4">
            <img src="/api/placeholder/60/60" alt="채팅방 이미지" class="chat-avatar">
            <div class="chat-info">
                <div class="chat-header">
                    <div class="chat-title">일본 오사카 자유여행</div>
                    <div class="chat-time">3일 전</div>
                </div>
                <div class="chat-preview">
                    <div class="chat-last-message">오사카 교통패스 구입 방법 알려드립니다.</div>
                </div>
                <div class="chat-hashtags">
                    <div class="chat-hashtag">#일본</div>
                    <div class="chat-hashtag">#오사카</div>
                </div>
                <div class="chat-participants">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <div class="chat-participant-count">+3</div>
                </div>
            </div>
        </div>

         채팅방 5 (읽지 않은 메시지가 있는 경우) 
        <div class="chat-room unread" data-id="5">
            <img src="/api/placeholder/60/60" alt="채팅방 이미지" class="chat-avatar">
            <div class="chat-info">
                <div class="chat-header">
                    <div class="chat-title">사진 공유 채널</div>
                    <div class="chat-time">2일 전</div>
                </div>
                <div class="chat-preview">
                    <div class="chat-last-message">오늘 제주도 서귀포 일출 사진입니다!</div>
                    <div class="chat-badge">5</div>
                </div>
                <div class="chat-hashtags">
                    <div class="chat-hashtag">#사진</div>
                    <div class="chat-hashtag">#풍경</div>
                </div>
                <div class="chat-participants">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <img src="/api/placeholder/24/24" alt="참여자" class="chat-participant">
                    <div class="chat-participant-count">+12</div>
                </div>
            </div>
        </div>
    </div>

     빈 상태 (채팅방이 없을 때) - 기본적으로 숨김 처리 
    <div class="empty-state" style="display: none;">
        <i class="far fa-comment-dots"></i>
        <div class="empty-state-title">아직 참여 중인 채팅방이 없어요</div>
        <p class="empty-state-text">새로운 채팅방을 만들거나 다른 채팅방에 참여해보세요!</p>
        <button class="create-first-chat">새 채팅방 만들기</button>
    </div>
</div>-->

<div class="chat-list">
    <div class="chat-room" 
         th:each="room : ${chatRooms}" 
         th:attr="data-id=${room.id}">
         
        <img th:src="${room.thumbnailImageUrl != null ? room.thumbnailImageUrl : '/api/placeholder/60/60'}"
             alt="채팅방 이미지" class="chat-avatar"/>

        <div class="chat-info">
            <div class="chat-header">
                <div class="chat-title" th:text="${room.title}">채팅방 제목</div>
                <div class="chat-time" th:text="${#temporals.format(room.createdAt, 'MM-dd HH:mm')}">시간</div>
            </div>

            <div class="chat-preview">
                <div class="chat-last-message">최근 메시지를 불러옵니다...</div> <!-- 이후 확장 -->
            </div>

            <div class="chat-hashtags">
                <div class="chat-hashtag">#해시태그</div> <!-- 추후 확장용 -->
            </div>

            <div class="chat-participants">
                <div class="chat-participant-count">+0</div> <!-- 참여자 수 표기 (추후 확장용) -->
            </div>
        </div>
    </div>
</div>



<!-- 채팅방 생성 모달 -->
<div class="modal-overlay" id="create-chat-modal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">새 채팅방 만들기</h3>
            <div class="modal-close" id="close-create-modal">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">채팅방 제목</label>
            <input type="text" class="form-input" id="chat-title" placeholder="제목을 입력하세요 (최대 30자)" maxlength="30">
        </div>
        <div class="form-group">
            <label class="form-label">해시태그 (최대 5개)</label>
            <div class="hashtag-input">
                <div class="hashtag">#여행 <span class="remove-hashtag">×</span></div>
                <input type="text" class="hashtag-input-field" placeholder="태그 입력 후 Enter...">
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">공지사항 (선택)</label>
            <textarea class="form-textarea" id="chat-notice" placeholder="채팅방 공지사항을 입력하세요 (최대 100자)"
                      maxlength="100"></textarea>
        </div>
        <div class="form-group">
            <label class="form-label">설명글 (선택)</label>
            <textarea class="form-textarea" id="chat-description" placeholder="채팅방에 대한 설명을 입력하세요 (최대 200자)"
                      maxlength="200"></textarea>
        </div>
        <div class="modal-footer">
            <button class="cancel-button" id="cancel-create">취소</button>
            <button class="create-button" id="confirm-create">채팅방 만들기</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 채팅방 생성 모달
        const createChatBtn = document.getElementById('create-chat-btn');
        const createChatModal = document.getElementById('create-chat-modal');
        const closeCreateModal = document.getElementById('close-create-modal');
        const cancelCreate = document.getElementById('cancel-create');
        const confirmCreate = document.getElementById('confirm-create');
        const emptyStateBtn = document.querySelector('.create-first-chat');

        // 해시태그 입력
        const hashtagInput = document.querySelector('.hashtag-input-field');
        const hashtagContainer = document.querySelector('.hashtag-input');
        const removeHashtags = document.querySelectorAll('.remove-hashtag');

        // 채팅방 필터
        const chatFilters = document.querySelectorAll('.chat-filter');

        // 채팅방 목록
        const chatRooms = document.querySelectorAll('.chat-room');

        // 모달 열기/닫기 함수
        function openModal(modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modal) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // 채팅방 생성 모달 열기
        createChatBtn.addEventListener('click', function () {
            openModal(createChatModal);
        });

        // 빈 상태에서 채팅방 생성 버튼
        if (emptyStateBtn) {
            emptyStateBtn.addEventListener('click', function () {
                openModal(createChatModal);
            });
        }

        // 채팅방 생성 모달 닫기
        closeCreateModal.addEventListener('click', function () {
            closeModal(createChatModal);
        });

        cancelCreate.addEventListener('click', function () {
            closeModal(createChatModal);
        });

        // 채팅방 생성 확인
        confirmCreate.addEventListener('click', function () {
            const title = document.getElementById('chat-title').value;
            const notice = document.getElementById('chat-notice').value;
            const description = document.getElementById('chat-description').value;

            // 유효성 검사
            if (!title) {
                alert('채팅방 제목을 입력해주세요.');
                return;
            }

            // 채팅방 생성 처리 (실제로는 서버에 요청)
            alert('새 채팅방이 생성되었습니다!');
            closeModal(createChatModal);

            // 폼 초기화
            document.getElementById('chat-title').value = '';
            document.getElementById('chat-notice').value = '';
            document.getElementById('chat-description').value = '';
        });

        // 해시태그 추가
        hashtagInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && this.value.trim()) {
                e.preventDefault();

                // 해시태그 개수 확인 (최대 5개)
                const currentTags = document.querySelectorAll('.hashtag').length;
                if (currentTags >= 5) {
                    alert('해시태그는 최대 5개까지 추가할 수 있습니다.');
                    return;
                }

                // 해시태그 생성
                const tag = document.createElement('div');
                tag.className = 'hashtag';
                tag.innerHTML = `#${this.value.trim()} <span class="remove-hashtag">×</span>`;

                // 제거 버튼 이벤트 추가
                tag.querySelector('.remove-hashtag').addEventListener('click', function () {
                    tag.remove();
                });

                // 입력 필드 앞에 해시태그 추가
                hashtagContainer.insertBefore(tag, this);
                this.value = '';
            }
        });

        // 기존 해시태그 제거 버튼
        removeHashtags.forEach(button => {
            button.addEventListener('click', function () {
                this.parentElement.remove();
            });
        });

        // 채팅방 필터 클릭 이벤트
        chatFilters.forEach(filter => {
            filter.addEventListener('click', function () {
                chatFilters.forEach(f => f.classList.remove('active'));
                this.classList.add('active');

                // 실제로는 필터링 로직 추가
            });
        });

        // 채팅방 클릭 이벤트 (채팅방 상세 페이지로 이동)
        chatRooms.forEach(room => {
            room.addEventListener('click', function () {
                // 채팅방 ID 가져오기
                const chatId = this.getAttribute('data-id');

                // 채팅방 상세 페이지로 이동
                window.location.href = `chat-detail.html?id=${chatId}`;
            });
        });

        // 검색 기능
        const searchInput = document.querySelector('.search-input');
        searchInput.addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase();

            // 검색어가 있을 경우 필터링
            if (searchTerm) {
                chatRooms.forEach(room => {
                    const title = room.querySelector('.chat-title').textContent.toLowerCase();
                    const lastMessage = room.querySelector('.chat-last-message').textContent.toLowerCase();
                    const hashtags = Array.from(room.querySelectorAll('.chat-hashtag')).map(tag => tag.textContent.toLowerCase());

                    // 제목, 마지막 메시지, 해시태그에서 검색어 포함 여부 확인
                    const matchTitle = title.includes(searchTerm);
                    const matchMessage = lastMessage.includes(searchTerm);
                    const matchHashtag = hashtags.some(tag => tag.includes(searchTerm));

                    // 어느 하나라도 포함되면 표시, 아니면 숨김
                    if (matchTitle || matchMessage || matchHashtag) {
                        room.style.display = 'flex';
                    } else {
                        room.style.display = 'none';
                    }
                });
            } else {
                // 검색어가 없으면 모두 표시
                chatRooms.forEach(room => {
                    room.style.display = 'flex';
                });
            }
        });
    });
</script>
</th:block>
</body>
</html>