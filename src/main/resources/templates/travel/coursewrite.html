<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>여행 코스 작성</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* 기존 스타일과 거의 동일, 일부 수정 및 추가 */
    :root {
      --primary-color: #0ED8D5;
      --primary-dark: #04A6A4;
      --primary-light: #E0F7F7;
      --secondary-color: #FF8C38;
      --text-color: #333333;
      --text-secondary: #666666;
      --text-light: #888888;
      --background-color: #F8F9FA;
      --white: #FFFFFF;
      --border-color: #EEEEEE;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.07);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Noto Sans KR', sans-serif;
    }

    body {
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
    }

    .container {
      display: flex;
      max-width: 1300px;
      margin: 0 auto;
      min-height: 100vh;
      position: relative;
      box-shadow: var(--shadow-lg);
    }

    .left-banner {
      flex: 0 0 45%;
      position: relative;
      overflow: hidden;
      background: linear-gradient(120deg, var(--primary-color), var(--primary-dark));
    }

    .banner-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.5) 100%);
      z-index: 1;
    }

    .banner-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.9;
      filter: saturate(1.2);
    }

    .banner-text {
      position: absolute;
      top: 25%;
      left: 10%;
      color: var(--white);
      z-index: 2;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .banner-text h1 {
      font-size: 3.2rem;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      letter-spacing: -0.5px;
    }

    .banner-text p {
      font-size: 1.1rem;
      font-weight: 400;
      max-width: 80%;
      margin-bottom: 2rem;
      opacity: 0.9;
    }

    .banner-button {
      display: inline-block;
      padding: 12px 24px;
      background-color: var(--white);
      color: var(--primary-dark);
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 1rem;
      text-decoration: none;
      box-shadow: var(--shadow-md);
      transition: var(--transition);
    }

    .qr-code {
      position: absolute;
      bottom: 30px;
      right: 30px;
      width: 100px;
      height: 100px;
      background-color: var(--white);
      padding: 10px;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow-md);
      z-index: 2;
    }

    .app-download {
      position: absolute;
      bottom: 30px;
      left: 30px;
      color: var(--white);
      font-size: 0.95rem;
      z-index: 2;
    }

    .app-store-buttons {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    .app-store-buttons img {
      height: 36px;
      cursor: pointer;
      transition: var(--transition);
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    .right-content {
      flex: 0 0 100%;
      background-color: var(--white);
      overflow-y: auto;
      padding: 25px;
      position: relative;
    }

    .right-content::-webkit-scrollbar {
      width: 8px;
    }

    .right-content::-webkit-scrollbar-track {
      background: var(--background-color);
    }

    .right-content::-webkit-scrollbar-thumb {
      background-color: #DDD;
      border-radius: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 25px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .back-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-color: var(--white);
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .header-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-color);
      letter-spacing: -0.5px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .notification-icon {
      position: relative;
      cursor: pointer;
      font-size: 1.2rem;
      color: var(--text-secondary);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .notification-badge {
      position: absolute;
      top: -2px;
      right: -2px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background-color: var(--secondary-color);
      color: white;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .profile-area {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .profile-pic {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary-color);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 0.95rem;
      color: var(--text-color);
    }

    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      transition: border-color 0.2s ease;
    }

    .form-group input[type="text"]:focus,
    .form-group input[type="number"]:focus,
    .form-group textarea:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 2px var(--primary-light);
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    #map {
      width: 100%;
      height: 300px;
      background-color: #f0f0f0;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }

    .trip-summary-inputs {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
    }

    .trip-summary-inputs .form-group {
      flex: 1;
      margin-bottom: 0;
    }

    .trip-summary-inputs input {
      background-color: #f8f9fa;
      color: var(--text-secondary);
    }

    /* 읽기 전용 스타일 */

    .places-container {
      margin-bottom: 20px;
    }

    .place-card {
      background-color: var(--white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      margin-bottom: 25px;
      padding: 20px;
      position: relative;
    }

    .place-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .place-card-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--primary-dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .place-card-title .place-order {
      font-size: 0.9rem;
      background-color: var(--primary-color);
      color: white;
      padding: 3px 8px;
      border-radius: var(--radius-sm);
    }

    .delete-place-button {
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: background-color 0.2s ease;
      font-size: 0.9rem;
    }

    .delete-place-button:hover {
      background-color: #cc0000;
    }

    .place-photos, .place-related-posts {
      margin-top: 15px;
    }

    .place-photos h5, .place-related-posts h5 {
      font-size: 1rem;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }

    .photo-gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .photo-gallery img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
    }

    .related-posts-list ul {
      list-style: none;
      padding-left: 0;
    }

    .related-posts-list li {
      padding: 8px;
      background-color: var(--primary-light);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .related-posts-list li:last-child {
      margin-bottom: 0;
    }

    .pac-container {
      z-index: 1050 !important; /* Google Places Autocomplete dropdown z-index */
    }

    .button-primary {
      padding: 12px 20px;
      border: none;
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      background-color: var(--primary-color);
      color: var(--white);
    }

    .button-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
    }

    .action-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-top: 30px;
      padding-bottom: 70px;
    }

    .navbar {
      display: flex;
      justify-content: space-around;
      background-color: var(--white);
      padding: 16px 0;
      border-top: 1px solid var(--border-color);
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      max-width: 1300px;
      margin: 0 auto;
      box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-light);
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .nav-item i {
      font-size: 1.2rem;
      margin-bottom: 5px;
    }

    .nav-item.active {
      color: var(--primary-color);
      font-weight: 600;
    }

    .center-add-button {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-size: 1.4rem;
      margin-top: -40px;
      box-shadow: 0 4px 15px rgba(3, 139, 139, 0.3);
    }

    @media (max-width: 1200px) {
      .container { flex-direction: column; height: auto; min-height: 100vh; }
      .left-banner { display: none; }
      .right-content { flex: 1; }
      .navbar { display: flex; }
    }
    @media (max-width: 768px) {
      .trip-summary-inputs { flex-direction: column; gap: 0; }
      .trip-summary-inputs .form-group { margin-bottom: 15px; }
      .action-buttons { flex-direction: column; }
      .button-primary { width: 100%; }
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .tag {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      padding: 6px 12px;
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      animation: fadeInUp 0.25s ease-in-out;
    }

    .tag .remove-tag {
      margin-left: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    @keyframes fadeInUp {
      from {
        transform: translateY(8px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

  </style>
</head>
<body>
<div class="container">
  <!--<div class="left-banner">
    <div class="banner-overlay"></div>
    <img src="https://via.placeholder.com/800x1200/0ED8D5/FFFFFF?text=TRIPSODA+Banner" alt="여행 친구들" class="banner-image">
    <div class="banner-text"><h1>함께라면<br>못 갈 곳은<br>없어</h1><p>새로운 친구들과 함께하는 특별한 여행, 당신만의 모험을 시작하세요.</p><a href="#" class="banner-button">지금 시작하기</a></div>
    <div class="app-download"><p>앱을 다운로드하고<br>더 깊게 모험하세요!</p><div class="app-store-buttons"><img src="https://via.placeholder.com/120x40/FFFFFF/000000?text=Google+Play" alt="Google Play"><img src="https://via.placeholder.com/120x40/FFFFFF/000000?text=App+Store" alt="App Store"></div></div>
    <img src="https://via.placeholder.com/100x100/FFFFFF/000000?text=QR" alt="QR 코드" class="qr-code">
  </div>-->

  <div class="right-content">
    <form id="tripCourseForm">
      <div class="header">
        <div class="header-left">
          <div class="back-button" id="back-button" onclick="history.back()"><i class="fas fa-arrow-left"></i></div>
          <h2 class="header-title">여행 추천 코스 작성</h2>
        </div>
        <div class="header-actions">
          <div class="notification-icon"><i class="far fa-bell"></i><span class="notification-badge">3</span></div>
          <div class="profile-area"><img src="https://via.placeholder.com/36/0ED8D5/FFFFFF?text=User" alt="프로필" class="profile-pic"><span>김여행</span></div>
        </div>
      </div>

      <div class="form-group">
        <label for="recommendationTitle">추천 코스 제목</label>
        <input type="text" id="recommendationTitle" name="recommendationTitle" placeholder="예: 서울 역사와 미식 탐방 2일 코스" required>
      </div>
      <div class="form-group">
        <label for="recommendationSubtitle">추천 코스 부제목 (요약 설명)</label>
        <textarea id="recommendationSubtitle" name="recommendationSubtitle" placeholder="예: 경복궁에서 시작하여 전통 시장과 현대적인 맛집을 아우르는 여정"></textarea>
      </div>
      <div class="form-group">
        <label for="categoryTags">카테고리 태그</label>
        <input type="text" id="categoryTagsInput" placeholder="태그 입력 후 Enter를 눌러 추가 (최대 5개)" autocomplete="off">
        <div id="categoryTagsList" class="tag-list"></div>
      </div>

      <div class="form-group">
        <label for="placeSearchInput">장소 검색 및 추가 (Google Places)</label>
        <input type="text" id="placeSearchInput" placeholder="추가할 장소를 검색하세요...">
      </div>

      <div id="map"></div> <div class="trip-summary-inputs">
      <div class="form-group">
        <label for="totalPlaces">총 장소 수</label>
        <input type="number" id="totalPlaces" name="totalPlaces" value="0" readonly>
      </div>
      <div class="form-group">
        <label for="totalDistance">총 거리</label>
        <input type="text" id="totalDistance" name="totalDistance" value="0 km" readonly>
      </div>
      <div class="form-group">
        <label for="totalTravelTime">총 이동시간</label>
        <input type="text" id="totalTravelTime" name="totalTravelTime" value="0 분" readonly>
      </div>
    </div>

      <hr style="margin: 30px 0; border-color: var(--border-color);">
      <h3><i class="fas fa-route"></i> 여행 경로 목록</h3>
      <div class="places-container" id="placesContainer">
      </div>

      <div class="action-buttons">
        <button type="submit" id="saveCourseButton" class="button-primary"><i class="fas fa-save"></i> 최종 코스 저장</button>
      </div>
    </form>

    <div class="navbar">
      <div class="nav-item"> <i class="fas fa-home"></i> <span>커뮤니티</span> </div>
      <div class="nav-item active"> <i class="far fa-compass"></i> <span>여행추천</span> </div>
      <div class="nav-item"> <div class="center-add-button"> <i class="fas fa-plus"></i> </div> </div>
      <div class="nav-item"> <i class="far fa-user"></i> <span>내 프로필</span> </div>
      <div class="nav-item"> <i class="fas fa-cog"></i> <span>세팅</span> </div>
    </div>
  </div>
</div>

<script>
  let map;
  let directionsService;
  let directionsRenderer;
  let autocomplete;
  let selectedPlaces = []; // 사용자가 선택한 장소 객체 배열 (Google Place Result + 추가 정보)
  const placeSearchInput = document.getElementById('placeSearchInput');
  const placesContainer = document.getElementById('placesContainer');
  const tripCourseForm = document.getElementById('tripCourseForm');
  const totalPlacesInput = document.getElementById('totalPlaces');
  const totalDistanceInput = document.getElementById('totalDistance');
  const totalTravelTimeInput = document.getElementById('totalTravelTime');

  function initMap() {
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer();
    map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: 37.5665, lng: 126.9780 }, // 기본 서울 중심
      zoom: 12,
      mapTypeControl: false
    });
    directionsRenderer.setMap(map);

    autocomplete = new google.maps.places.Autocomplete(placeSearchInput, {
      types: ['establishment', 'geocode'], // 모든 장소 유형 또는 주소
      fields: ['place_id', 'name', 'formatted_address', 'geometry', 'photos', 'types', 'rating', 'user_ratings_total', 'opening_hours', 'website', 'international_phone_number']
    });
    autocomplete.addListener('place_changed', onPlaceSelected);
  }

  async function onPlaceSelected() {
    const place = autocomplete.getPlace();
    if (!place.geometry || !place.geometry.location) {
      console.log("선택된 장소에 대한 유효한 위치 정보가 없습니다.");
      placeSearchInput.value = ""; // 입력 필드 초기화
      return;
    }

    // Google Place Result에 사용자 정의 필드 추가 가능
    const newPlaceData = {
      googlePlace: place, // Google Places API에서 받은 원본 데이터
      placeId: place.place_id,
      name: place.name,
      address: place.formatted_address,
      location: place.geometry.location,
      photos: place.photos ? place.photos.slice(0, 5).map(p => p.getUrl({maxWidth: 400, maxHeight: 400})) : [], // 최대 5개 사진 URL
      relatedPosts: [] // 초기 빈 배열, 서버에서 가져올 예정
    };

    // 백엔드에서 관련 게시물 가져오기 (예시)
    try {
      newPlaceData.relatedPosts = await fetchRelatedPostsFromServer(newPlaceData.placeId, newPlaceData.name);
    } catch (error) {
      console.error("관련 게시물을 가져오는 데 실패했습니다:", error);
      // 오류가 발생해도 장소는 추가되도록 처리
    }

    selectedPlaces.push(newPlaceData);
    renderPlacesList();
    updateRouteAndSummary();
    placeSearchInput.value = ""; // 입력 필드 초기화
  }

  // --- 백엔드 연동 함수 (예시) ---
  async function fetchRelatedPostsFromServer(placeId, placeName) {
    // TODO: 실제 백엔드 API 엔드포인트로 교체하세요.
    // 예시: const response = await fetch(`/api/posts/related?placeId=${placeId}&placeName=${encodeURIComponent(placeName)}`);
    // if (!response.ok) throw new Error('서버 응답 오류');
    // const posts = await response.json();
    // return posts; // [{ title: "게시물1", url: "/post/1" }, ...] 형태의 배열 반환 기대

    // 아래는 임시 더미 데이터 반환 (실제 구현 시 삭제)
    console.log(`서버에 ${placeName}(ID: ${placeId}) 관련 게시물 요청 (더미 데이터 사용)`);
    return new Promise(resolve => {
      setTimeout(() => {
        resolve([
          { title: `${placeName} 방문 후기!`, url: '#' },
          { title: `[맛집] ${placeName} 근처 추천 식당`, url: '#' },
        ]);
      }, 500);
    });
  }
  // --- 백엔드 연동 함수 (예시 끝) ---


  function renderPlacesList() {
    placesContainer.innerHTML = ''; // 기존 목록 초기화
    selectedPlaces.forEach((placeData, index) => {
      const card = document.createElement('div');
      card.classList.add('place-card');
      card.dataset.placeId = placeData.placeId;

      let photosHTML = '<p>사진 정보 없음</p>';
      if (placeData.photos && placeData.photos.length > 0) {
        photosHTML = placeData.photos.map(photoUrl => `<img src="${photoUrl}" alt="${placeData.name} 사진">`).join('');
      }

      let relatedPostsHTML = '<p>관련 게시물 정보 없음</p>';
      if (placeData.relatedPosts && placeData.relatedPosts.length > 0) {
        relatedPostsHTML = '<ul>' + placeData.relatedPosts.map(post => `<li><a href="${post.url || '#'}" target="_blank">${post.title}</a></li>`).join('') + '</ul>';
      }

      card.innerHTML = `
        <div class="place-card-header">
          <h4 class="place-card-title"><span class="place-order">${index + 1}</span> ${placeData.name}</h4>
          <button type="button" class="delete-place-button" data-index="${index}"><i class="fas fa-trash-alt"></i> 삭제</button>
        </div>
        <p><i class="fas fa-map-marker-alt"></i> ${placeData.address || '주소 정보 없음'}</p>
        <div class="place-photos">
          <h5><i class="fas fa-camera"></i> 장소 사진 (Google 제공)</h5>
          <div class="photo-gallery">${photosHTML}</div>
        </div>
        <div class="place-related-posts">
          <h5><i class="fas fa-book-open"></i> 관련 게시물 (DB 연동)</h5>
          <div class="related-posts-list">${relatedPostsHTML}</div>
        </div>
      `;
      placesContainer.appendChild(card);
    });

    // 삭제 버튼 이벤트 리스너 추가
    document.querySelectorAll('.delete-place-button').forEach(button => {
      button.addEventListener('click', function() {
        const indexToRemove = parseInt(this.dataset.index);
        selectedPlaces.splice(indexToRemove, 1);
        renderPlacesList();
        updateRouteAndSummary();
      });
    });
    totalPlacesInput.value = selectedPlaces.length;
  }

  function updateRouteAndSummary() {
    if (selectedPlaces.length < 2) {
      directionsRenderer.setDirections({routes: []}); // 경로 초기화
      map.setCenter(selectedPlaces.length === 1 ? selectedPlaces[0].location : { lat: 37.5665, lng: 126.9780 });
      map.setZoom(selectedPlaces.length === 1 ? 15 : 12);
      totalDistanceInput.value = "0 km";
      totalTravelTimeInput.value = "0 분";
      // 단일 장소 마커 표시 (선택적)
      if (selectedPlaces.length === 1) {
        // 이전 마커들을 지우고 새 마커를 찍거나, DirectionsRenderer가 마커를 관리하도록 할 수 있습니다.
        // 여기서는 DirectionsRenderer가 경로 없을 시 마커도 지우므로, 단일 마커를 원하면 별도 로직 필요.
      }
      return;
    }

    const waypoints = selectedPlaces.slice(1, selectedPlaces.length - 1).map(p => ({
      location: p.location,
      stopover: true
    }));

    const request = {
      origin: selectedPlaces[0].location,
      destination: selectedPlaces[selectedPlaces.length - 1].location,
      waypoints: waypoints,
      optimizeWaypoints: true, // 경유지 최적화 (순서대로 이동 시 false)
      travelMode: google.maps.TravelMode.DRIVING // 또는 WALKING, BICYCLING, TRANSIT
    };

    directionsService.route(request, function(result, status) {
      if (status == 'OK') {
        directionsRenderer.setDirections(result);
        const route = result.routes[0];
        let totalDistance = 0;
        let totalDuration = 0;
        route.legs.forEach(leg => {
          totalDistance += leg.distance.value; // 미터 단위
          totalDuration += leg.duration.value; // 초 단위
        });
        totalDistanceInput.value = (totalDistance / 1000).toFixed(1) + " km";
        totalTravelTimeInput.value = Math.round(totalDuration / 60) + " 분";
      } else {
        console.error('Directions request failed due to ' + status);
        alert('경로를 계산할 수 없습니다: ' + status);
        totalDistanceInput.value = "오류";
        totalTravelTimeInput.value = "오류";
      }
    });
  }

  tripCourseForm.addEventListener('submit', function(event) {
    event.preventDefault();
    const courseTitle = document.getElementById('recommendationTitle').value;
    const courseSubtitle = document.getElementById('recommendationSubtitle').value;
    const courseTags = document.getElementById('categoryTags').value;

    // 서버로 전송할 최종 데이터 객체 구성
    const finalCourseData = {
      title: courseTitle,
      subtitle: courseSubtitle,
      tags: courseTags.split(',').map(tag => tag.trim()).filter(tag => tag),
      places: selectedPlaces.map(p => ({ // 필요한 정보만 추려서 저장
        placeId: p.placeId,
        name: p.name,
        address: p.address,
        latitude: p.location.lat(),
        longitude: p.location.lng(),
        // photos: p.photos, // 사진 URL 저장 여부 결정
        // relatedPosts: p.relatedPosts // DB에서 ID 등으로 관리할 수도 있음
      })),
      totalDistance: totalDistanceInput.value,
      totalTravelTime: totalTravelTimeInput.value,
      totalPlaces: selectedPlaces.length
    };

    console.log('최종 저장될 코스 데이터:', JSON.stringify(finalCourseData, null, 2));
    alert('코스 데이터가 콘솔에 JSON 형태로 출력되었습니다. 실제 서버 저장 로직을 구현하세요.');
    // TODO: 여기서 finalCourseData를 서버로 전송 (예: fetch POST 요청)
  });

  const tagInput = document.getElementById('categoryTagsInput');
  const tagListContainer = document.getElementById('categoryTagsList');
  let currentTags = [];

  tagInput.addEventListener('keydown', function (e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      const value = tagInput.value.trim();
      if (value && currentTags.length < 5 && !currentTags.includes(value)) {
        currentTags.push(value);
        renderTags();
        tagInput.value = '';
      } else if (currentTags.length >= 5) {
        alert('태그는 최대 5개까지 입력 가능합니다.');
      }
    }
  });

  function renderTags() {
    tagListContainer.innerHTML = '';
    currentTags.forEach((tag, index) => {
      const tagEl = document.createElement('div');
      tagEl.className = 'tag';
      tagEl.innerHTML = `
      ${tag}
      <span class="remove-tag" data-index="${index}">&times;</span>
    `;
      tagListContainer.appendChild(tagEl);
    });

    document.querySelectorAll('.remove-tag').forEach(btn => {
      btn.addEventListener('click', () => {
        const index = parseInt(btn.dataset.index);
        currentTags.splice(index, 1);
        renderTags();
      });
    });
  }

</script>
<!--<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAM6flDj7toqktYW83oYswdJrH-xrEsz4U&libraries=places,maps,directions&callback=initMap&language=ko&region=KR"></script>&ndash;&gt;-->
</body>
</html>